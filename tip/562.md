# TIP 562: Deprecate channel types 1-4
        Author:         Jan Nijtmans <jan.nijtmans@gmail.com>
        State:          Draft
        Type:           Project
        Vote:           Pending
        Created:        31-Jan-2020
        Post-History:
        Tcl-Version:    8.7
        Keywords:       Tcl
        Tcl-Branch:     deprecate-channel-type-1-4
-----

# Abstract

This TIP proposes to deprecate channel types 1-4, and remove it completely
for Tcl 9.0. Only channels with type `TCL_CHANNEL_VERSION_5` will be
accepted by Tcl 9.0. Also, for Tcl 9.0, the `seekProc` and `closeProc`
will no longer be used, `wideSeekProc` and `close2Proc` will be used
in stead. Any Tcl 8.6 channel with version `TCL_CHANNEL_VERSION_5`
implementing `wideSeekProc` and `close2Proc` will be source-compatible
with Tcl 9.0 and continue to work unchanged.

# Rationale and Discussion

The different channel versions allow various combination of functions
implemented, all of those combinations need to be tested for and
maintained. For example there is a `closeProc` and an `close2Proc`,
there is a `seekProc` and a `wideSeekProc`. Let's clean-up that
for Tcl 9.0 and make it simpler to be maintained.

For Tcl 9.0, if your channel has seek functionality, `wideSeekProc`
needs to be implemented. `seekProc` will not be used any more. So,
if you want to create a channel type that is source compatible with
both Tcl 8.x and 9.0, either implement both `seekProc` and
`wideSeekProc` either none of them. In Tcl 9.0 this restriction
will be lifted, but Tcl 8.6 requires that if `wideSeekProc` is
implemented `seekProc` should be implemented as well. We cannot
change that any more in Tcl 8.6.

Further on, for Tcl 9.0 channels, `close2Proc` is required,
`closeProc` will not be used any more. So any channel compatible
with both Tcl 8.x and Tcl 9.0 needs to implement both `closeProc`
and `close2Proc`. If your Tcl 8.6-compatible channel doesn't
implement `close2Proc` yet, you can add an implementation as
follows:

<pre>
static int close2Proc(
    void *instanceData,
    Tcl_Interp *interp,
    int flags)
{
    if ((flags&(TCL_CLOSE_READ|TCL_CLOSE_WRITE))==0) {
        return closeProc(instanceData, interp);
    }
    return EINVAL;
}
</pre>

# Proposal

TODO

## Incompatibilities

TODO

# Implementation


# Copyright

This document has been placed in the public domain. 
