# TIP 485: Remove Deprecated API
	Author:         Jan Nijtmans <jan.nijtmans@gmail.com>
	State:          Draft
	Type:           Project
	Vote:           Pending
	Created:        08-Nov-2017
	Post-History:   
	Tcl-Version:    9.0
-----

# Abstract

The "case" command, and the "read \<chan\> nonewline" construct are replaced
by better commands long ago (resp. "switch" and "read -nonewline \<chan\>"),
but the old forms were never actually removed from the Tcl code base. They still
work. See also [bug #3151675](https://core.tcl.tk/tcl/tktview/3151675).
For Tcl 9.0 it is finally time to actually remove it.

In addition, there are a number of C API's which have better successors
by now. This TIP proposes to finally remove all of those in Tcl 9.0.

# Rationale

The "case" command is superseded by the "switch" command.

The "read \<chan\> nonewline" construct is superseded by "read -nonewline \<chan\>".

The "puts \<chan\> \<line\> nonewline" construct is superseded by "read -nonewline \<chan\> \<line\>".

The function `Tcl_Backslash` is superseded by `Tcl_UtfBackslash`

   * This is more than a matter of naming. `Tcl_Backslash` returns a
     single char. It cannot return all possible character values 
     produced in Tcl backslash sequences.  Moving to the successor
     function fixes bugs.

The function `Tcl_EvalFile` is superseded by `Tcl_FSEvalFile`

The function `Tcl_GetDefaultEncodingDir` is superseded by `Tcl_GetEncodingSearchPath`

The function `Tcl_SetDefaultEncodingDir` is superseded by `Tcl_SetEncodingSearchPath`

The function `Tcl_EvalTokens` is superseded by `Tcl_EvalTokensStandard`

Finally, the functions `Tcl_CreateMathFunc`, `Tcl_GetMathFuncInfo` and `Tcl_ListMathFuncs`
are superseded by [TIP #232](232.md)

# Proposed Change

If Tcl 8.7 is compiled with the flag `-DTCL_NO_DEPRECATED`, the "case" command,
the "read \<chan\> nonewline", and the "puts \<chan\> \<line\> nonewline"
constructs will be disabled. In Tcl 9.0 all related
code will actually be removed from the Tcl code base. 

The following API's are declared deprecated in Tcl 8.7 and will be
fully removed in Tcl 9.0. If Tcl 8.7 is compiled with the flag `-DTCL_NO_DEPRECATED`,
all deprecated API is disabled, by making those entries `MODULE_SCOPE`, and
putting 0 in the corresponding stub entries.  This can be used by extensions
to see whether they are compatible with the next major Tcl release or not.
Those functions are already removed in the "novem" branch:

 * `Tcl_Backslash`

 * `Tcl_EvalFile`

 * `Tcl_GetDefaultEncodingDir`

 * `Tcl_SetDefaultEncodingDir`

 * `Tcl_EvalTokens`

 * `Tcl_CreateMathFunc`

 * `Tcl_GetMathFuncInfo`

 * `Tcl_ListMathFuncs`

An implementation of this TIP can be found in the [tip-485](https://core.tcl.tk/tcl/timeline?r=tip-485) branch.
This branch is based on "core-8-branch" (Tcl 8.7), but can be trivially merged forward to trunk (Tcl 9.0).

# Rejected Alternatives

TODO

# Copyright

This document has been placed in the public domain.
