# TIP 587: Default utf-8 for source command
	Author:         Jan Nijtmans <jan.nijtmans@gmail.com>
	State:          Draft
	Type:           Project
	Created:        20-Sept-2020
	Post-History:   
	Keywords:       Tcl source
	Tcl-Version:    9.0
	Tcl-Branch:     tip-587
-----

# Abstract

This TIP proposes to make the default encoding for the "source" command utf-8.

# Rationale

The "utf-8" encoding is the most universal encoding available, more and more
systems use it as system encoding. Introducing this change means that
Tcl-9 scripts can start using any Unicode character without needing to
use the escaped \\u???? or \\U?????? forms.

Starting with TIP #389 (Tcl 8.7), invalid bytes 0x80 up to 0x9F are interpreted
as the cp1252 characters € up to Ÿ. This means that any script which was
written in the "cp1252" encoding (most common on Windows) will get the
expected outcome using Tcl's "utf-8" decoder. Since "cp1252" is a superset
of "iso8859-1" (most common on other UNIX'es), the same holds for "iso8859-1".

Tcl's current "utf-8" decoder strips the first BOM (Byte Order Mark) from
the stream. This means that even scripts using the Windows BOM-prepended
"utf-8" files (not recommended, but still can be produced by Notepad)
will work fine.

# Specification

 * The `source` command without `-encoding` will assume "utf-8" as default in
   stead of the system encoding.
 * Scripts started from the "tclsh" commandline without `-encoding` will
   read the file using Tcl's "utf-8" decoder.
 * The `open` command and other channel functionalities are kept as
   they are now.

# Compatibility

For scripts using ASCII characters only (as was the only portable way
to write scripts in Tcl 8.x) this is fully upwards compatible. Scripts
assuming a different system encoding than "ascii", "utf-8", "cp1252"
or "iso-8859-1" will break.

# Implementation

See the [`tip-587`](https://core.tcl-lang.org/tcl/timeline?r=tip-587) branch.

# Copyright

This document has been placed in the public domain.
