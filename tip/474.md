# TIP 474: Treat the mouse wheel events in a uniform way
	Author:	Arjen Markus <arjen.markus895@gmail.com>
	Author:	Jan Nijtmans <jan.nijtmans@gmail.com>
	State:	Draft
	Type:	Project
	Vote:	Pending
	Created:	25-Aug-2017
	Post-history:	PM
	Tcl-Version:	8.7
	Keywords:	Tk, events
	Tk-Branch:	tip474
-----

# Abstract

This TIP proposes to treat the mouse wheel events on all platforms in a
similar way. Currently, a program running on Windows should bind to
"MouseWheel" events, whereas a program running on Linux should bind to
"ButtonPress-4" and "ButtonPress-5" commands. This makes it somewhat
awkward to support both types of platforms.


# Rationale

Tk provides a means to define user-interfaces using code that is almost
perfectly independent of the platform that the program should run on. It
therefore makes sens that the treatment of user actions, such as mouse
clicks and the use of the mouse wheel should be independent of the
platform as well. Currently, however, "Windows-type" and OSX platforms
support the "MouseWheel" event, whereas for "Linux-type" platforms the
program should bind to "ButtonPress-4" and "ButtonPress-5"  events.
This is in contrast to almost all other events and event bindings.

The documentation in its present form only describes the "MouseWheel"
form.


# Current behaviour

The code fragment below illustrates the behaviour: run it under various
platforms and use the mouse wheel in the canvas window to see which
bindings fired.

    pack [canvas .c]
    
    catch {console show}
    
    bind .c <Button> [list puts "Button %W %b"]
    bind .c <Shift-Button> [list puts "Shift-Button %W %b"]
    bind .c <Control-Button> [list puts "Control-Button %W %b"]
    bind .c <MouseWheel> [list puts "MouseWheel %W %D"]
    bind .c <Shift-MouseWheel> [list puts "Shift-MouseWheel %W %D"]
    bind .c <Control-MouseWheel> [list puts "Control-MouseWheel %W %D"]


# Specification

This TIP proposes to extend the bindings for the mouse wheel in such a
way that it does not matter which platform the program runs on. On
X11, the "Button 4" up to "Button 7" events will be translated internally
to equivalent "MouseWheel" events. The modifiers "Option" and "Shift"
will be supported analogously.

As an example, the bindings for the text widget look like this:

    bind Text <MouseWheel> {
        %W yview scroll [expr {-%D/3}] pixels
    }
    bind Text <Option-MouseWheel> {
        %W yview scroll [expr {-3*%D}] pixels
    }
    bind Text <Shift-MouseWheel> {
        %W xview scroll [expr {-%D/3}] pixels
    }
    bind Text <Shift-Option-MouseWheel> {
        %W xview scroll [expr {-3*%D}] pixels
    }

with the %D substitution giving the right amount of pixels.

# Considerations regarding the incompatibility

The physical buttons 4 up to 9 on Windows or Mac, will be
translated to X11 buttons 8 up to 13. From the script level
nothing changes: They still can be accessed from scripts
as being buttons 4 up to 9. This means that buttons 4 to 7
on X11 are not accessible through scripts any more, the
only way to access those are through the translated
MouseWheel events. On X11, buttons 4 up to 9 in scripts
will handle the X11 buttons numbered 8 up to 13.

On macOS, the scaling for MouseWheel buttons has always
been different from those on Windows, with a factor of 120.
This means that applications assuming Tk 8.6 <MouseWheel>
events will need to be modified to the new behaviour,
otherwise the screen movements will be far too much.
On Windows, everything works as before, no incompatibility
there. Many applications already define the <MouseWheel>
binding on X11, even though in Tk 8.6 they are not
used. Such applications will work on X11 in Tk 8.7 the
same as in Tk 8.6

If the application needs to support Tcl/Tk 8.6, an extra
check is required to decide which events to listen to.
An example can be found in the "cscroll" demo.

This seems a minor inconvenience for gaining further
platform-independence.

# Reference Implementation

In tk branch tip474.

# Copyright

This document is placed in public domain.

