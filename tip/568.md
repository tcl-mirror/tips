# TIP 568: Revise ByteArray Routines To Support Proper Value Extraction
	Author:         Don Porter <dgp@users.sourceforge.net>
	State:          Draft
	Type:           Project
	Vote:           Pending
	Created:        4-Mar-2020
	Post-History:
	Keywords:       bytearray
	Tcl-Version:    9.0
	Tcl-Branch:	dgp-properbytearray
-----

# Abstract

PLEASE HOLD YOUR COMMENTS WHILE UNDER CONSTRUCTION.

This TIP revises the public routines **Tcl_GetByteArrayObj** and
**Tcl_SetByteArrayLength** to signal an error when they are passed
an _objPtr_ that does not contain a valid byte sequence.

# Background

It is a convention of the Tcl C interface to have routines with names
like **Tcl_GetFooFromObj**. Their purpose is to extract a value in
the _foo_ representation from a (*Tcl_Obj* _*_) argument. The caller
should then be able to process the extracted _foo_ value 
confident that it represents the original *Tcl_Obj* value.
Each one of these routines is associated with one or more **Tcl_ObjType**s
such that multiple calls to **Tcl_GetFooFromObj** can benefit from
internal representation caching.

These routines follow one of three patterns. The first,

> _int_ **Tcl_GetFooFromObj**(*Tcl_Interp* *, *Tcl_Obj* *, ..., _foo_ *);

is used when the *foo* representation is of fixed size that is not too large.
The _int_ return allows for returning **TCL_ERROR** when no valid *foo*
can be extracted. The *Tcl_Interp* is provided to receive standardized
error messages and codes on failure.  The final output argument is a pointer
to space where the extracted *foo* value may be written. (Foo = Boolean,
Double, Index, Int, Long, WideInt, Encoding)

(Bignum)

The second pattern,

> _foo_ **Tcl_GetFooFromObj**(*Tcl_Interp* *, *Tcl_Obj* *, ...);

(Foo = RegExp, Command)



# History and Rationale

# Specification

# Compatibility

# Scope

This TIP proposes a change to **Tcl_GetByteArrayFromObj** that is an
incompatibity in its return value.  There is also interest (see [TIP 481])
in making another incompatible change to the same routine in the type of
its final output argument. It is out of scope to merge these concerns.
They can be accompilshed as orthogonal matters in either sequence.

# Reference Implementation

See branch [dgp-properbytearray](https://core.tcl-lang.org/tcl/timeline?t=dgp-properbytearray).

# Copyright

This document has been placed in the public domain.
