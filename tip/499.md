# TIP 499: Custom locale search list for msgcat
	Author:         Harald Oehlmann <oehhar@sourceforge.com>
	State:          Draft
	Type:           Project
	Vote:           Pending
	Created:        07-Dec-2017
	Post-History:
	Keywords:       msgcat, oo
	Tcl-Version:    8.7
-----

# Abstract

Package **msgcat** derives its locale search list from one locale to set.
This TIP proposes the possibility to use a custom locale search list.

# Rationale

If one specifies a locale (example: Austrian German):

<pre>
% msgcat::mclocale de_at
</pre>

the locale search list is set (called 'preferences'):

<pre>
% msgcat::mcpreferences
de_at de {}
</pre>

So, if someone looks for a translation, they are looked up in the given order: Austrian German, German, Root:

<pre>
% msgcat::mcset {} jan January
% msgcat::mc jan
January
% msgcat::mcset de January Januar
% msgcat::mc January
Januar
% msgcat::mcset de_at January Jänner
% msgcat::mc January
Jänner
</pre>

There are cases, where it is desireable to set this list to a custom list, which may not be acheved by the specification of one locale.

## Use-case 1: Partial translations

I have an application, which is translated to English and German.

There is one screen, I want to translate to French (and everything else where are translations, but there are only in 3rd party packages).
The masks without French translations should show the English text.

So, the desired locale search list is: "fr en {}".

Then, I can do a partial translation of some texts which will show-up in French.

## Use-case 2: Mixed language regions

Regions like the Vorarlberg belong to Austria and prefer Austrian German, but the local language is closer to Swiss German.

So, their prefered search list is: "de_at de_ch de {}".

## Use-case 3: Secondary language setting

An application may choose to allow the user to specify a first and 2nd language, for example French and English.

In consequence, the prefered search list is a mixure of the chosen languages: "fr en {}".

# Usage

The following extensions are proposed to current msgcat 1.6.1:

## Extension 1: Set the global locale search list

To set a custom locale search list, the existing command `mcpreferences` is extended to take arguments.
If arguments are specfified, they are used to set the locale search list:

<pre>
% msgcat::mcpreferences fr de {}
fr de {}
</pre>

The current locale is always the first element of the locale search list (this is no change and has been always true):

<pre>
% msgcat::mclocale
fr
</pre>

Setting the locale will replace a custom locale search list:

<pre>
% msgcat::mclocale de
de
% msgcat::mcpreferences
de {}
</pre>

## Extension 2: Set the package locale search list

A package may also have a package locale.
The extension is to support a custom package locale search list.

A custom package locale search list may be set by the new subcommand:

<pre>
% namespace eval mypack {msgcat::mcpackagelocale setpreferences fr de {} }
fr de {}
</pre>

The package locale is always the first element of the package locale search list (custom or not):

<pre>
% namespace eval mypack {msgcat::mcpackagelocale get}
fr
</pre>

A custom package locale is replaced, if a package locale is set:

<pre>
% namespace eval mypack {msgcat::mcpackagelocale set de}
de
% namespace eval mypack {msgcat::mcpackagelocale set preferences}
de {}
</pre>

# Implementation

The implementation is in tcl fossil in branch
[tip499-msgcat-custom-preferences](https://core.tcl.tk/tcl/timeline?r=tip499-msgcat-custom-preferences).

There are no tests and no man page jet.
Please use this text as man-page.

# Copyright

This document has been placed in the public domain.
