# TIP 522: Test error codes with Tcltest
	Author:		Peter Spjuth <peter.spjuth@gmail.com>
	State:		Draft
	Type:		Project
	Vote:		Pending
	Created:	22-Oct-2018
	Post-History:
	Tcl-Version:	8.7
	Tcl-Branch:	tip-522
	Keywords:	tcltest, error codes
-----

# Abstract

Proposes a new test option to test error codes (not to be confused with
return codes).

# Rationale

All or most core commands have error codes with their errors.
With the addition of try and throw, error codes are now an integral part
of the error ecosystem.
However, testing them is a bit clunky and few commands have tests for them.

The most obvious test usage for them are exact matching and prefix matching,
both easily done with a glob pattern since error codes do not have special
characters.

# Specification

Add a new option, -errorCode, to the test command in tcltest.
When -errorCode is given and non-empty it is tested, as a glob pattern,
against the error code from test execution.
When -errorCode is given, -returnCodes defaults to 1.

# Example

This

	test dict-4.13 {dict replace command: type check is mandatory} -body {
	    dict replace { a b c d e }
	} -returnCodes error -result {missing value to go with key}
	test dict-4.13a {dict replace command: type check is mandatory} {
	    catch {dict replace { a b c d e }} -> opt
	    dict get $opt -errorcode
	} {TCL VALUE DICTIONARY}

is replaced by this

	test dict-4.13 {dict replace command: type check is mandatory} -body {
	    dict replace { a b c d e }
	} -errorCode {TCL VALUE DICTIONARY} -result {missing value to go with key}

# Copyright

This document has been placed in the public domain.
