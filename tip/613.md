# TIP 613: New INDEX\_NULL\_OK flag for Tcl_GetIndexFromObj*()
	Author:         Jan Nijtmans <jan.nijtmans@gmail.com>
	State:          Draft
	Type:           Project
	Vote:           Pending
	Created:        09-Dec-2021
	Post-History:   
	Keywords:       Tcl Tcl_GetIndexFromObj() Tcl_GetIndexFromObjStruct()
	Tcl-Version:    8.7
	Tcl-Branch:     tip-613
-----

# Abstract

This TIP proposes a new <b>INDEX\_NULL\_OK</b> flag for <b>Tcl\_GetIndexFromObj*()</b>  as <b>TCL\_INDEX\_NULL\_OK</b>.

# Rationale

In <b>Tk</b>, serveral options allow the empty string, but since <b>Tcl\_GetIndexFromObjStruct()</b> cannot handle
the empty string as input well, this results in special code in Tk to handle that. This is
not always done correctly, e.g.:
<pre>
$ wish8.6
% text .t
.t
% .t tag configure dummy -relief {}
% .t tag configure dummy -relief xxx
bad relief "xxx": must be flat, groove, raised, ridge, solid, or sunken
% .t tag configure dummy -wrap {}
% .t tag configure dummy -wrap foo
bad wrap "foo": must be char, none, word, or 
% 
</pre>
So, the error-message doesn't even mention that "" is a valid value, or it forgets
to quote the empty value.

The cause of the problem is [here](https://core.tcl-lang.org/tk/file?udc=1&ln=27&ci=73d9515d7f13f6fa&name=generic%2FtkTextTag.c):
the empty string is made part of a string array used by <b>Tcl\_GetIndexFromObj*()</b>.

The meaning of <b>TCL\_INDEX\_NULL\_OK</b> is that <b>Tcl\_GetIndexFromObj*()</b> no longer
gives an error when objPtr is supplied a NULL or "" argument, but it will return TCL_OK
and provide the index "-1". This functionality can then be used by Tk:
<pre>
$ wish8.7
% text .t
.t
% .t tag configure dummy -wrap {}
% .t tag configure dummy -wrap foo
bad wrap "foo": must be char, none, word, or ""
% 
</pre>

# Implementation

Available in the [`tip-613`](https://core.tcl-lang.org/tcl/timeline?r=tip-613&unhide) branch.

This branch targets 8.7.

# Copyright

This document has been placed in the public domain.
